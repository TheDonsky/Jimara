image: 
  - Visual Studio 2019

environment:
  VULKAN_SDK: C:/VulkanSDK/1.3.211.0

cache:
  - c:\VulkanSDK\

install:
  - if not exist %VULKAN_SDK% curl -L --silent --show-error --output VulkanSDK.exe https://sdk.lunarg.com/sdk/download/1.3.211.0/windows/VulkanSDK-1.3.211.0-Installer.exe && VulkanSdk install --al --am -c
  - set PATH=%PATH%;%VULKAN_SDK%\Bin
  - cd %APPVEYOR_BUILD_FOLDER%
  - git submodule update --init --recursive
  - python jimara_initialize.py --no_elevate --no_pause
  - NuGet restore Project\Windows\MSVS2019\Jimara.sln

configuration: [Debug, Release]

build_script:
  - call "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars64.bat"
  - msbuild Project\Windows\MSVS2019\Jimara.sln /p:Configuration="%CONFIGURATION%" /p:Platform="x64"

after_build:
  - |
      7z a Jimara-"%CONFIGURATION%"-x64.zip           ./__BUILD__\MSVS2019\Jimara\x64\"%CONFIGURATION%"\*
      7z a Jimara-Editor-"%CONFIGURATION%"-x64.zip    ./__BUILD__\MSVS2019\Jimara-Editor\x64\"%CONFIGURATION%"\*
      7z a Jimara-Tests-"%CONFIGURATION%"-X64.zip     ./__BUILD__\MSVS2019\Jimara-Test\x64\"%CONFIGURATION%"\*

artifacts:
  - path: '*.zip'

test_script:
  - cd __BUILD__\MSVS2019\Jimara-Test\x64\%CONFIGURATION% && Jimara-Test.exe
