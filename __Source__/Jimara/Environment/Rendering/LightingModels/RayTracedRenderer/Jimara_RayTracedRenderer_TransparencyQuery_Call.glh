
/** __________________________________________________________________________________________________________ */
/** ######################################## TRANSPARENCY-QUERY-CALL: ######################################## */
#pragma JM_LightingModelStage TransparencyQuery_Call JM_CallableShader;
#if TransparencyQuery_Call

void main() {
	JM_FragmentData JM_RT_fragmentData;
	JM_ShadingState JM_RT_shadingState;
	const bool initialized = JM_RT_InitMaterialState(JM_RT_fragmentData, JM_RT_shadingState);
	if (!initialized) {
		jimara_RayTracedRenderer_Call_Payload.flags = JM_RT_PAYLOAD_FLAGS_INIT_FAILED;
		return;
	}
	else jimara_RayTracedRenderer_Call_Payload.flags = 0;

#if JM_BlendMode != JM_Blend_Opaque
	jimara_RayTracedRenderer_Call_Payload.fragmentColor.w = JM_Opacity(JM_RT_shadingState);
	if (jimara_RayTracedRenderer_Call_Payload.fragmentColor.w < JM_RT_MIN_VALID_OPACITY)
		jimara_RayTracedRenderer_Call_Payload.flags |= JM_RT_PAYLOAD_FLAGS_FULLY_TRANSPARENT;
#else
	jimara_RayTracedRenderer_Call_Payload.fragmentColor.w = 1.0;
#endif
}

#endif // ShadeFragment_Call
